# Syslog Collector Testing Framework

This directory contains Python-based testing tools for the syslog collector with UUID traceability support.

## Quick Start

1. **Setup the testing environment:**
   ```bash
   cd testing/
   ./setup.sh
   ```

2. **Activate the Python environment:**
   ```bash
   source .venv/bin/activate
   ```

3. **Send test messages:**
   ```bash
   # Send all test messages
   python send_syslog.py --all
   
   # Send specific source type
   python send_syslog.py --source cisco-asa
   python send_syslog.py --source palo-alto
   python send_syslog.py --source linux-syslog
   
   # Send with UUID traceability
   python send_syslog.py --all --uuid
   ```

## Test Sources

The testing framework supports three distinct log sources that match your collector configuration:

### 1. Cisco ASA Firewall
- **Matcher**: `hostname="ciscoasa*"`
- **Format**: RFC 3164
- **Sample**: `<134>Jul 29 15:10:22 ciscoasa01 %ASA-4-313001: Built inbound TCP connection...`
- **Expected Parser**: `ciscoFirewall2`

### 2. Palo Alto Firewall
- **Matcher**: `appname="PA-220*"`
- **Format**: RFC 3164
- **Sample**: `<134>Jul 29 15:10:22 firewall01 PA-220-PA-220: THREAT: virus detected...`
- **Expected Parser**: `paloAltoFirewall`

### 3. Linux Syslog-ng
- **Matcher**: `srcip="10.10.20.5"`
- **Format**: RFC 5424
- **Sample**: `<134>1 2025-07-29T15:10:22.000Z linuxserver01 sshd 12345 AUTH [exampleSDID@32473 srcip="10.10.20.5"]...`
- **Expected Parser**: `linuxSyslog`

## UUID Traceability

The UUID feature is designed for testing and troubleshooting:

### Environment Control
- Set `INJECT_UUID=true` in your `.env` file, or
- Use the `--uuid` flag to force UUID injection

### How It Works
1. **Client-side generation**: UUIDs are generated by the Python script (no container changes)
2. **Syslog injection**: UUIDs are injected into the syslog message as `[TEST_UUID=uuid-here]`
3. **Traceability**: The UUID is printed to console for correlation with SIEM events

### Example with UUID
```bash
python send_syslog.py --source cisco-asa --uuid
```

Output:
```
üîç Generated UUID for traceability: 550e8400-e29b-41d4-a716-446655440000
‚úÖ Sent Cisco ASA Firewall (hostname=ciscoasa01)
   Expected Parser: ciscoFirewall2
   Trace UUID: 550e8400-e29b-41d4-a716-446655440000
   Message: <134>Jul 29 15:10:22 ciscoasa01 [TEST_UUID=550e8400-e29b-41d4-a716-446655440000] %ASA-4-313001: Built inbound TCP connection...
```

## Troubleshooting

### Verify Collector is Running
```bash
# Check if containers are up
docker-compose ps

# Check syslog-ng logs
docker-compose logs syslog-ng

# Check scalyr-agent logs
docker-compose logs scalyr-agent
```

### SIEM Query Tips
- **Use parser-based queries** for better accuracy (avoid generic message field searches)
- **Search by UUID** when traceability is enabled
- **Example queries**:
  - `parser = "ciscoFirewall2"`
  - `parser contains "paloAlto"`
  - `TEST_UUID = "your-uuid-here"`

### Common Issues
1. **Connection refused**: Make sure the collector is running (`docker-compose up -d`)
2. **No events in SIEM**: Check API tokens and network connectivity
3. **Wrong parser**: Verify the source configuration matches the log format

## Files

- `send_syslog.py`: Main testing script with UUID support
- `setup.sh`: Environment setup script
- `requirements.txt`: Python dependencies
- `.venv/`: Python virtual environment (created by setup.sh)

## Integration with Main Project

This testing framework integrates with the main syslog collector:

- **Reads configuration** from parent directory `.env` file
- **Sends to collector** at `127.0.0.1:514` (same port as collector listens on)
- **Matches source types** defined in main collector configuration
- **UUID injection** works without modifying collector containers
